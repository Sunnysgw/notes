# mysql 优化

## 1. 索引数据结构

> 索引是帮助MySQL高效获取数据的一种排好序的数据结构。`

如果不加索引，查询数据的过程需要逐行扫描，如果表中数据较多，就需要大量的磁盘io操作，而io操作是比较耗费性能的。索引的使命就是要通过预先存储一些地址信息，减少查询次数。

索引的几种候选的数据结构

- 二叉搜索树

  保证对于任意节点，左节点小于等于节点，右节点大于等于节点，可以用来存储mysql的索引，但是可能会退化成链表，不能保证查询效率

- 红黑树

  可以有效控制二叉搜索树的高度平衡，防止二叉树退化。但是，这样一层存储的内容还是有点少，表的容量上来了，树的高度也上来了，不太巧的话，查找过程中需要每层都走一遍，io还是高了

- b树

  针对红黑树每个节点容量比较小的问题，有了b树，如下

  ![image-20220927210458142](E:\Document\work\笔记\image-20220927210458142.png)

- b+树

  针对b树做了一些优化

  ![image-20220927210538212](E:\Document\work\笔记\image-20220927210538212.png)

  非叶子节点不存数据，叶子节点包含了所有的索引元素，叶子节点使用指针连接，提高了区间访问的性能。同时因为非叶子节点不存数据，所以可以存更多的地址，树的高度也就越小。

  一个非叶子节点大小为16kb，是磁盘一个卷的大小，读取一个节点需要一次io。

  一次查询过程？增加索引的过程？

目前大多数用innodb引擎，引擎是在表级别生效的。存储引擎

- myisam引擎

  索引和数据是分离的？索引使用b+树的结构，属于非聚集索引

- innodb引擎

  索引和数据是放一起的，即叶子节点存放的是其他列的数据，属于聚集索引